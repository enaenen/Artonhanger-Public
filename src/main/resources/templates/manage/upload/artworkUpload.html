<!doctype html>
<html lang="en">
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="manage/fragments/headerImport :: headerImport"/>
<meta name="_csrf" th:content="${_csrf.token}"/>
<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
<body>
<style>
    .preview {
        max-width: 100px;
        height: 100px;
        margin-top: 20px;
    }
</style>
<!-- WRAPPER -->

<div id="wrapper">
    <!-- NAVBAR -->
    <div th:replace="manage/fragments/navHeader :: navHeader"/>
    <!-- LEFT SIDEBAR -->
    <div th:replace="manage/fragments/sidebar :: sidebar"></div>
    <!-- END LEFT SIDEBAR -->
    <!-- MAIN -->
    <div class="main">
        <!-- MAIN CONTENT -->
        <div class="main-content">
            <div class="container-fluid">
                <!-- OVERVIEW -->
                <div class="panel panel-headline">
                    <div class="panel-heading">
                        <h3 class="panel-title">작품 업로드</h3>
                        <p class="panel-subtitle" th:text="${member.nickname}"></p>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-md-6 offset-md-3 mt-5">
                                <form accept-charset="UTF-8" th:action="@{/upload/artwork}" method="POST"
                                      enctype="multipart/form-data" class="upload-form" id="upload-form">
                                    <div class="row">
                                        <div class="form-group col-md-5">
                                            <label for="title">작품명</label>
                                            <input type="text" name="title" class="form-control" id="title"
                                                   placeholder="작품명" required="required">
                                        </div>

                                        <div class="form-group col-md-5">
                                            <label for="productionYear">년도</label>
                                            <input type="number" step="any" name="productionYear" class="form-control"
                                                   id="productionYear"
                                                   placeholder="작품 제작년도" required="required">
                                        </div>
                                    </div>
                                    <hr>
                                    <div class="row">
                                        <div class="form-group col-md-5">
                                            <label for="height">높이(cm)</label>
                                            <input type="number" step="any" name="height" class="form-control"
                                                   id="height" placeholder="높이 (cm)"
                                                   required="required">
                                        </div>
                                        <div class="form-group col-md-5">
                                            <label for="width">넓이(cm)</label>
                                            <input type="number" step="any" name="width" class="form-control" id="width"
                                                   placeholder="넓이 (cm)"
                                                   required="required">
                                        </div>
                                    </div>
                                    <hr>
                                    <label for="photoFrame">액자</label>
                                    <div class="form-group">
                                        <select class="selectpicker" id="photoFrame" name="photoFrame" title="액자포함여부">
                                            <option th:value="0">미포함</option>
                                            <option th:value="1">액자 포함</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <div class="form-group" id="photoFrameInfo" name="photoFrameInto">
                                        </div>
                                    </div>
                                    <hr>
                                    <label for="categories">카테고리</label>
                                    <div class="form-group">
                                        <select class="selectpicker" multiple data-max-options="2" id="categories"
                                                name="categories" required="required">
                                            <option value="LANDSCAPE">풍경</option>
                                            <option value="PERSON">인물</option>
                                            <option value="OBJECT">사물</option>
                                            <option value="ORGANISM">동식물</option>
                                            <option value="ABSTRACT">추상</option>
                                            <option value="GRAPHIC">그래픽</option>
                                            <option value="CHARACTER">캐릭터</option>
                                            <option value="SCULPTURE">도예/입체</option>
                                            <option value="ETC">기타</option>
                                        </select>
                                    </div>
                                    <label for="materials">재료</label>
                                    <div class="form-group">

                                        <select class="selectpicker" multiple data-max-options="2" id="materials"
                                                name="materials">
                                            <option value="OILPASTEL">오일파스텔</option>
                                            <option value="ACRYLICPAINT">아크릴</option>
                                            <option value="WATERCOLORS">수채화</option>
                                            <option value="PASTEL">파스텔</option>
                                            <option value="PENCILS">소묘</option>
                                            <option value="OILCOLORS">유채물감</option>
                                            <option value="INK">잉크</option>
                                            <option value="SCULPTURE">도예/입체</option>
                                            <option value="OTHERINGREDIENTS">기타</option>
                                        </select>
                                    </div>
                                    <label for="colors">메인 컬러</label>
                                    <div class="form-group">

                                        <select class="selectpicker" multiple data-max-options="2" id="colors"
                                                name="colors" required="required">
                                            <option value="RED">빨강</option>
                                            <option value="ORANGE">주황</option>
                                            <option value="YELLOW">노랑</option>
                                            <option value="GREEN">초록</option>
                                            <option value="BLUE">파랑</option>
                                            <option value="NAVY">남색</option>
                                            <option value="PURPLE">보라</option>
                                            <option value="PINK">핑크</option>
                                            <option value="GRAY">회색</option>
                                            <option value="WHITE">흰색</option>
                                            <option value="BLACK">검정</option>
                                            <option value="PASTEL">파스텔</option>
                                            <option value="FLUORESCENT">형광</option>
                                            <option value="ETC">기타</option>
                                        </select>
                                    </div>
                                    <hr>

                                    <div class="row">
                                        <div class="form-group col-md-5">
                                            <label for="price">가격 (숫자만 입력)</label>
                                            <input type="number" name="price" class="form-control" id="price"
                                                   placeholder="가격(숫자만 입력)" required="required">
                                        </div>
                                        <div class="form-group col-md-5">
                                            <label for="deliveryPrice">배송비 선택</label>
                                            <select class="form-control" id="deliveryPrice" name="deliveryPrice"
                                                    required="required">
                                                <option value="3000">3000원</option>
                                                <option value="5000">5000원</option>
                                                <option value="7000">7000원</option>
                                            </select>
                                        </div>
                                    </div>
                                    <hr>
                                    <!--             사진 업로드                       -->
                                    <div class="row">
                                        <div class="form-group multiple-form-group">
                                            <div class="form-group input-group">
                                                <img class="preview" src="/assets/img/preview-icon.png"
                                                     alt="your image"/>
                                                <input type="file" accept="image/jpeg, image/png, image/bmp"
                                                       name="artworkImages[]" onchange="readURL(this);"
                                                       class="imageUpload"/>
                                                <textarea name="descriptions[]" class="form-control" rows="3"
                                                          placeholder="작가님의 이야기가 때로는 작품을 선택하는 기준이 되기도 합니다.
작품과 작가님에 대해 최대한 자세한 설명을 부탁드립니다."></textarea>
                                                <span class="input-group-btn">
                                                      <button type="button" class="btn btn-default btn-add">+</button>
                                                </span>
                                                <textarea name="descriptions[]" class="default-ta" rows="4"
                                                          hidden="true"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <input type="button" onclick="handleUpload()" value="업로드" class="btn btn-primary"
                                           name="submit" id="submitBtn"/>
                                    <!--                                    <button type="submit" class="btn btn-primary">업로드</button>-->
                                </form>
                                <!--    <div th:replace="fragments/footer :: footer"/>-->
                            </div>
                            <script src="/assets/scripts/imageUpload.js"></script>
                            <script src="/assets/js/jquery-3.5.1.min.js"></script>
                            <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.bundle.min.js"></script>

                            <!--                            <script src="/assets/selectTemplate/js/bootstrap-select.js"></script>-->
                            <!--                            <link href="/assets/selectTemplate/css/bootstrap-select.css" rel="stylesheet" type="text/css"/>-->
                        </div>
                    </div>
                </div>
                <!-- END OVERVIEW -->
                <div class="row">
                </div>
                <!-- END RECENT PURCHASES -->
            </div>
            <div class="col-md-6">
                <!-- MULTI CHARTS -->
                <!-- END MULTI CHARTS -->
            </div>
        </div>
        <div class="row">
            <div class="col-md-7">
            </div>
            <div class="col-md-5">
                <!-- TIMELINE -->
                <div class="panel-body">
                </div>
            </div>
            <!-- END TIMELINE -->
        </div>
    </div>
    <div class="row">
        <div class="col-md-4">
        </div>
        <div class="col-md-4">
            <!-- VISIT CHART -->
            <div class="panel">
                <div class="panel-heading">
                </div>
            </div>
            <!-- END VISIT CHART -->
        </div>
        <div class="col-md-4">
            <!-- REALTIME CHART -->
        </div>
        <!-- END REALTIME CHART -->
    </div>
</div>
</div>
</div>
<!-- END MAIN CONTENT -->
</div>
<!-- END MAIN -->
<div class="clearfix"></div>
<footer>
    <div class="container-fluid">
        <p class="copyright">&copy; 2017 <a href="https://www.themeineed.com" target="_blank">Theme I Need</a>. All
            Rights Reserved.</p>
    </div>
</footer>
</div>
<!-- END WRAPPER -->
<!-- Javascript -->
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
<!-- Latest compiled and minified JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
<script src="/assets/scripts/frameSelection.js"></script>
<link rel="stylesheet" href="//rawgit.com/Soldier-B/jquery.toast/master/jquery.toast/jquery.toast.min.css"/>
<script src="//rawgit.com/Soldier-B/jquery.toast/master/jquery.toast/jquery.toast.min.js"></script>
<script type="text/javascript">
    function verifySize(value) {
        if (value <= 0)
            return false;
        return true;
    }

    function verifyEmptyValue(value, text) {
        if (value === '' || value === null) {
            $.toast('<h2>' + text + '</h2>', {
                duration: 2000,
                type: 'danger'
            });
            return false;
        }
        return true;
    };

    function handleUpload() {
        var isFramed = $('#photoFrame option:selected').val();
        $('#submitBtn').hide();
        if (
            !verifyEmptyValue($('#title').val(), '작품명을 입력해주세요.') ||
            !verifyEmptyValue($('#productionYear').val(), '작품 제작년도를 입력해주세요.') ||
            !verifyEmptyValue($('#width').val(), '작품 넓이를 입력해주세요.') ||
            !verifyEmptyValue($('#height').val(), '작품 높이를 입력해주세요.') ||
            !verifyEmptyValue($('#photoFrame').val(), '액자 포함여부를 선택해주세요') ||
            !verifyEmptyValue($('#categories').val(), '카테고리를 선택해주세요.') ||
            !verifyEmptyValue($('#materials').val(), '재료를 선택해주세요.') ||
            !verifyEmptyValue($('#colors').val(), '주 색상을 선택해주세요.') ||
            !verifyEmptyValue($('#price').val(), '가격을 입력해주세요.') ||
            !verifyEmptyValue($('#deliveryPrice').val(), '배송비를 입력해주세요.') ||
            !verifyEmptyValue($('.imageUpload').val(), '작품사진을 최소 1개이상 업로드해주세요!')
        ) {
            $('#submitBtn').show();
            return;
        }
        if (isFramed === "1") {
            if (!verifyEmptyValue($('.frameHeight'), '액자 높이를 입력해주세요.') ||
                !verifyEmptyValue($('.frameWidth'), '액자 넓이를 입력해주세요.') ||
                !verifyEmptyValue($('.photoFrameMaterial'), '액자 재질을 입력해주세요.')
            ) {
                $('#submitBtn').show();
                return;
            }
        }
        if (!verifySize($('#price').val())) {
            toastError('가격을 확인해주세요.');
            $('#submitBtn').show();
            return;
        }
        if (!verifySize($('#width').val()) || !verifySize($('#height').val())) {
            toastError('작품 사이즈를 확인해주세요.');
            $('#submitBtn').show();
            return;
        }
        dataSend();
        return;
    }

    $(document).ready(function () {
        $.toast.config.align = 'center';
        $.toast.config.width = 400;
    });

    function dataSend() {
        var formData = new FormData($("#upload-form")[0])
        var token = $("meta[name='_csrf']").attr("content");
        var header = $("meta[name='_csrf_header']").attr("content");
        $.ajax({
            async: false,
            url: "/upload/artwork",
            enctype: 'multipart/form-data',
            contentType: false,
            processData: false,
            data: formData,
            // dataType: 'json',
            type: "POST",
            beforeSend: function (xhr) {
                xhr.setRequestHeader(header, token);
            },
            success: function (data) {
                toastInfo("작품이 업로드되었습니다.")
                console.log(data);
                setTimeout(function () {
                    location.href = "/upload";
                }, 2000);
            },
            error: function (data) {
                var code = data.responseJSON.errCode;
                var message = data.responseJSON.message;
                var status = data.status;
                $('#submitBtn').show();
                if (code === "FUL_001")
                    toastError('사진파일 크기는 10MB 미만으로 업로드해주세요!');
                else if (code === "FUL_000")
                    toastError('허용된 파일 개수를 초과 하였습니다.');
                else if (code === "FUL_002")
                    toastError('허용된 파일 총 용량을 초과하였습니다. ');
                else if (code === "FUL_003")
                    toastError('업로드된 사진이 없습니다.');
                else if (code === "ETC_000")
                    toastError('서버 에러입니다 잠시 후 다시 시도해주세요.');
            }
        });
    }

    function toastInfo(text) {
        $.toast('<h2>' + text + '</h2>', {
            duration: 1000,
            type: 'info'
        });
        return;
    };

    function toastError(errorMessage) {
        $.toast('<h3>' + errorMessage + '</h3>', {
            duration: 2000,
            type: 'danger'
        });
        return;
    };
</script>
</body>

</html>
